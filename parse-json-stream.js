var x=class{constructor(e){this.state=17;this.string=void 0;this.unicode=void 0;this.callbacks=e}charError(e,t){throw new Error(`Unexpected token ${JSON.stringify(String.fromCharCode(e[t]))} at position ${t}`)}parse(e){for(var t,s=0,h=e.length;s<h;s++)switch(this.state){case 17:switch(t=e[s],t){case 123:this.callbacks.onStartObject(s);continue;case 125:this.callbacks.onEndObject(s);continue;case 91:continue;case 93:continue;case 58:continue;case 44:continue;case 116:this.state=33;continue;case 102:this.state=49;continue;case 110:this.state=65;continue;case 34:this.string="",this.state=97;continue;case 45:this.state=81;continue;case 48:this.state=82;continue}if(t>48&&t<64){this.state=83;continue}if(t===32||t===9||t===10||t===13)continue;this.charError(e,s);case 97:switch(t=e[s],t){case 34:this.callbacks.onString(this.string),this.string=void 0,this.state=17;continue;case 92:this.state=98;continue}if(t>=32){this.string+=String.fromCharCode(t);continue}this.charError(e,s);case 98:switch(t=e[s],t){case 34:this.string+='"',this.state=97;continue;case 92:this.string+="\\",this.state=97;continue;case 47:this.string+="/",this.state=97;continue;case 98:this.string+="\b",this.state=97;continue;case 102:this.string+="\f",this.state=97;continue;case 110:this.string+=`
`,this.state=97;continue;case 114:this.string+="\r",this.state=97;continue;case 116:this.string+="	",this.state=97;continue;case 117:this.unicode="",this.state=99;continue}this.charError(e,s);case 99:case 100:case 101:case 102:if(t=e[s],t>=48&&t<64||t>64&&t<=70||t>96&&t<=102){this.unicode+=String.fromCharCode(t),this.state++===102&&(this.string+=String.fromCharCode(parseInt(this.unicode,16)),this.unicode=void 0,this.state=97);continue}this.charError(e,s);case 81:if(t=e[s],t===48){this.state=82;continue}if(t>48&&t<64){this.state=83;continue}this.charError(e,s);case 82:this.finish(),s--;continue;case 83:this.finish(),s--;continue;case 84:if(t=e[s],t>=48&&t<64){this.state=85;continue}this.charError(e,s);case 85:if(t=e[s],t>=48&&t<64)continue;if(t===101||t===69){this.state=86;continue}this.finish(),s--;continue;case 86:if(t=e[s],t===43||t===45){this.state=87;continue}if(t>=48&&t<64){this.state=88;continue}this.charError(e,s);case 87:if(t=e[s],t>=48&&t<64){this.state=88;continue}this.charError(e,s);case 88:if(t=e[s],t>=48&&t<64)continue;this.finish(),s--;continue;case 33:if(e[s]===114){this.state=34;continue}this.charError(e,s);case 34:if(e[s]===117){this.state=35;continue}this.charError(e,s);case 35:if(e[s]===101){this.state=17;continue}this.charError(e,s);case 49:if(e[s]===97){this.state=50;continue}this.charError(e,s);case 50:if(e[s]===108){this.state=51;continue}this.charError(e,s);case 51:if(e[s]===115){this.state=52;continue}this.charError(e,s);case 52:if(e[s]===101){this.state=17;continue}this.charError(e,s);case 65:if(e[s]===117){this.state=66;continue}this.charError(e,s);case 66:if(e[s]===108){this.state=67;continue}this.charError(e,s);case 67:if(e[s]===108){this.state=17;continue}this.charError(e,s)}}finish(){switch(this.state){case 82:this.state=17;break;case 83:this.state=17;break;case 85:this.state=17;break;case 88:this.state=17;break}if(this.state!==17)throw new Error("Unexpected end of input stream")}};function N(S){let e=new TextDecoder,t=new Uint8Array(0),s=0,h=[],c=[],r=[],o=null;var E=new x({onString:function(n){o=n},onStartObject:function(n){o!==null&&(c.push(o),r.push(n+s))},onEndObject:function(n){for(let i of S)if(c.length==i.length){for(let a=0;a<c.length;a++)if(c[a]!=i[a]&&i[a]!="*")return;let R=JSON.parse(e.decode(t.subarray(r[r.length-1],n+1+s)));h.forEach(a=>a(c,R))}c.pop(),r.pop()}});return{write(n){s=t.length;let i=new Uint8Array(t.length+n.length);i.set(t),i.set(n,t.length),t=i,E.parse(n)},finish(){t=new Uint8Array(0),E.finish()},onObject(n){h.push(n)}}}export{N as parseJSONStream};
